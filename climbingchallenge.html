<!DOCTYPE HTML>
<html>
  <head>
    <title>2018 Climbing Challenge</title>

    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39900246-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-39900246-3');
    </script>

    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">
    <style>
      em {
        font-weight: 600;
        color: #6ad36a;
      }
      b {
        font-weight: 400;
      }
      .content-area {
        background-color: rgba(255, 255, 255, 0.90);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        margin: 1em;
        padding: 0.75em;
      }
      #header {
        text-align: center;
        font-size: 1.5em;
        margin-top: 0.3em;
        margin-bottom: 0.5em;
      }
      #progress {
        text-align: center;
      }
      #progress-header {
        font-size: 0.8em;
      }
      #progress-feet {
        font-size: 1.3em;
      }
      #progress-bar-bg {
        margin: 0.5em 10%;
        height: 0.8em;
        background-color: lightgray;
        position: relative;
      }
      #progress-bar {
        height: 100%;
        width: 0;
        background-color: #6ad36a;
      }
      #today-mark {
        position: absolute;
        top: -0.1em;
        height: 1em;
        width: 1px;
        background-color: black;
      }
      
      .body-text {
        text-align: left;
      }
      
      .date {
        margin-top: 1em;
        font-size: 0.8em;
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <!-- Background -->
    <div class="bg-img lucas-valley-img"></div>
        
    <!-- Header -->
    <div id='progress' class='content-area'>
     <div id='header'>Glenn's 2018 Climbing Challenge</div>
     <div id='progress-header'>PROGRESS</div>
      <div id='progress-feet'> </div>
      <div id='progress-bar-bg'>
        <div id='progress-bar'></div>
        <div id='today-mark'></div>
      </div>
      <div id='progress-text'> </div>
      <br/>
      <div class='body-text'>
        This is the year. I've come close to 1 million feet of climbing for the past
        3 years - 807,927 (2015), 820,299 (2016), and 880,344 (2017). It's time to finally
        hit the big goal.<br/><br/>
        
        I'm grateful to live in an area with beautiful weather and plenty of awesome hills to climb. Most 
        of my riding is on a mountain bike, but there will be some road 
        miles sprinkled in. Even though climbing is a major focus this year, my priorities are
        having fun and enjoying every ride.<br/><br/>
        
        Breaking things down, climbing 1 million feet requires an average of:
        <ul>
          <li>2,740 feet per day</li>
          <li>19,231 feet per week</li>
          <li>83,334 feet per month</li>
        </ul>
        I plan on riding 5-6 days a week, with about two weeks off for vacation. That works out to about
        275 rides for the year. Hitting the goal requires an average 3636 feet of climbing, per ride.
        Wish me luck! <br/><br/>Follow me on Strava if you'd like to track my progress.
        <br/><br/>
        <div style="text-align: center">
          <a style="display:inline-block;background-color:#FC4C02;color:#fff;padding:5px 10px 5px 30px;font-size:11px;font-family:Helvetica, Arial, sans-serif;white-space:nowrap;text-decoration:none;background-repeat:no-repeat;background-position:10px center;border-radius:3px;background-image:url('http://badges.strava.com/logo-strava-echelon.png')" href='http://strava.com/athletes/188506/badge' target="_clean">
            Follow me on
            <img src='http://badges.strava.com/logo-strava.png' alt='Strava' style='margin-left:2px;vertical-align:text-bottom' height=13 width=51 />
          </a>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script language="javascript">
      function showData(data) {        
        const year_goal = 1000000;
        /*
        const now = new Date();
        const current_day = (Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()) - Date.UTC(now.getFullYear(), 0, 0)) / (24 * 60 * 60 * 1000);
        const current_target = Math.round(year_goal * (current_day / 365));
        const current_actual = Math.round(data.ytd_ride_totals.elevation_gain * 3.28084);  // Totals are in meters
        const est_finish = new Date('January 1, 2018 00:00:00');
        est_finish.setDate(year_goal / (current_actual / current_day));
        */
        const current_target = 1000000;
        const current_day = 364;
        const current_actual = 1100666;
        
        var fmt = num => num.toLocaleString();
        
        document.getElementById('progress-feet').innerHTML = '<em>' + fmt(current_actual) +'</em> / ' + fmt(year_goal) + ' ft';
        document.getElementById('progress-bar').style.width = Math.min(100, ((current_actual * 100) / year_goal)) + '%';
        document.getElementById('today-mark').style.left = ((current_target * 100) / year_goal) + '%';
        
        var progressText;
        /*
        if (current_actual >= current_target) {
          progressText = fmt(current_actual - current_target) + ' ft ahead of pace';
        } else {
          progressText = fmt(current_target - current_actual) + ' ft behind pace';
        }
        progressText += '<br/>At this pace I\'ll finish on ' + est_finish.toLocaleDateString();
        */
        progressText = '<br/><b>Challenge completed on ' + new Date('November 18, 2018 00:00:00').toLocaleDateString() + '!</b>';
        
        document.getElementById('progress-text').innerHTML = progressText;
      }
       
      fetch('https://www.strava.com/api/v3/athletes/188506/stats?access_token=9dd14293e5f0cc0a69919994ffc2ea34ba6df85d')
        .then((response) => response.json())
        .then((data) => showData(data));
    </script>
  </body>
</html>